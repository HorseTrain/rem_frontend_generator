fl_instruction 32 move_wide_immediate (sf_1 opc_2 100101 hw_2 imm16_16 Rd_5)
{
    int shift = hw * 16;
    int immediate = imm16 << shift;

    o_type O = switch sf { case 0 : o32, case 1 : o64 };
    
    O result;

    if (opc == 0)
    {
        result = ~immediate;
    }
    else if (opc == 3)
    {
        result = X(Rd);

        result = result & ~(UINT16_MAX << shift);
        result = result | immediate;
    }
    else
    {
        result = immediate;
    }

    X(Rd, result);
}